# 日常研发基础流程规范

很多公司研发的产品，由于缺乏规范化、标准化的流程，导致在产品整个研发生命周期过程中，出现各种各样的问题，比如：需求随意变更，研发质量差、版本延期，这些问题严重的影响了研发各项工作的正常开展。因此，我们需要规范研发流程，通过标准化的流程来指导研发成员工作，从而更好地达成研发目标。

目前很多大厂的研发流程大致如下所示：



![image-20211019134045870](https://gitee.com/tizo_kingbb/picImg/raw/master/img/20211019134052.png)

目前根据我们公司的情况以及结合基础的规范流程，我们把上图做了以下小小的调整，暂时省略掉了 ”交互设计评审“，”详细设计“，因部署环境缺失的问题，我们暂时不存在灰度和UAT环境，当然这些东西都会在后续的工作中慢慢补齐，让大家真正体验到流程规范化的好处，经过各方的协调和评审，我们的研发流程如下所示，并且需要大家严格遵守：

![流程.jpg](https://gitee.com/tizo_kingbb/picImg/raw/master/img/20211019134114.png)



看完流程我们就一个个点的去看看每个环节干了些啥，我们开发同学在这个环节需要做啥，以及在每个环节的职能。





### 需求产出：

需求产出的环节，默认为该需求已经适合宣讲，也就是所谓的该版本需求为stable版本，可以对大家宣讲了，该需求文档会在需求宣讲的前2天内发送到大家手里，方便研发人员提前介入到需求中，提出自己的需求问题和见解，避免未见到需求就去开宣讲会议，而听的稀里糊涂。

其实我们的需求产出涵盖了以下内容：

1. 需求提出：这个环节主要是产品爸爸给我们提需求，每个需求都是他们从用户，或者自己绞尽脑汁想出来的，但是产品爸爸还拿不准，不能直接敲定，所以就需要我们大家（产品，UI，前端，后端，客户端和测试）一起讨论一下，看看这个需求是否合理，或者这个需求是否有意义，能否达到预期，技术实现的成本，周期等等。一旦聊成了，他们就会进入下一个阶段，聊不成他会想方设法让你答应，然后进入下个阶段，知道我为啥叫产品爸爸了吧？

2. 需求prd提出评审：
   这个阶段，产品爸爸会根据第一版聊下来的结果，大致出一个Demo版本的PRD，会画出初版的原型图，并且配上文字说明，所有涉及到的业务，还有交互细节都会罗列出来。这个时候大家又会围绕这一版本去开会讨论，敲定细节，这个环节会久点，因为细节比较认真，逻辑也不能出错，还有UI稿子也得敲定，这里如果不
   敲定逻辑，UI提前去画原型图，后面假如逻辑推翻，一切重来就会浪费大量时间。这一环节大家都会把细节问清楚，不了解的点也会去了解，测试，开发，UI我们都会在会议上提出自己的观点，自己的意见，然后等产品反馈，最后意见一致之后，产品当天就回改出敲定版本。UI就会按照产品爸爸的意思去作图，接下来就是交互设计评审了。

3. 交互设计评审：

   UI会画出客户端，前端，H5开发所需要的UI图，基本上就是我们看到的产品的样子了，不过还是要敲定细节，比如按钮合理不，或者上面数据是否在这展示，或者这里展示的数据是否合理。这个环节会比较快，只要UI按照之前敲定的逻辑开发，出入不会很大，一般都是小改。但是也不乏很多，之前敲定了情况，等UI按照敲定版本出了图，但是却发现出图之后有些不合理的点，比如是否应该在这里展示GMV（销售总额），或者是否这样展示活动规则啥的，会有这种情况，不过是小概率事件，改动也不会特别大。

   

默认的stable版本，也就是说宣讲阶段这些都已经敲定了，后续的修改需要走需求变更啦。



### 需求宣讲：

需求宣讲阶段，大家已经对需求了解的差不多了，因为真正实施需求的人员还是研发小组成员，所以在宣讲的时候，可能还会存在小小的问题，一般不阻碍原有整体业务逻辑的内容，我们都可以会上直接解决掉，除非遇到逻辑冲突等比较重大的风险点，才会考虑delay掉这次需求，或者重新修改业务逻辑，重新宣讲啦。

需求宣讲阶段我们需要做以下内容：

1.  创建钉钉交流群，方便本次需求的研发人员交流，研发工作环境内，四处奔跑是不可取的，除非真的交流软件已经无法说明该问题了，那就需要拉会到会议室去交流了，原则上不要影响别的研发人员。
2.  选举一个需求负责人，要对本需求负责的奥，整个需求研发到部署上线的整个周期内，你就是项目经理啦，jira工单的填写，showcase演示会议，整体排期的跟踪都是你的啦，当然根据有劳有得嘛, 你的kpi会比其他人略高，并且对自己也是一种磨练和提升嘛。后续人人都有机会作为项目经理。
3.  排期模板如下所示，钉钉群创建好，指定负责人之后，该表上传到群内，就可以开始排期了，主要呢包含以下内容：各端别的排期(由leader评估排期的合理性)， 各端别的联调时间，测试用例评审时间(测试写用例)， showcaseDemo演示时间，具体提测时间，测试人员测试环境测试时间(不包含集成测试时间)
   UAT环境和线上环境的时间比较特殊，UAT预发环境目前的主要功能是集成测试，与上线的时间间隔较短，是一个固定的时间，目前暂定未1天之后就要上线，上线之后还要辛苦测试在线上做需求测试，期间研发，产品都需要做后备支援，毕竟上线不是测试一个人的事情。UAT和上线的时间是由研发总监根据最后的测试完成时间给出的，延期上线是要追责的。

### 概要设计：目前给出宣讲之后最多1 - 2天的概要设计时间，大家抓紧时间了，对于简单的需求这部分可以直接省略。

这个是大厂程序员需求下来之后基本上都会做的一步，不过看需求大小，可能很多小需求直接就详细设计了，也有啥设计都不用做的小改动，具体需求具体分析嘛。

概要设计总体来说就是：需要说明本次需求的实现方案，以及带来的优点缺点，出问题之后的解决方案，还有可能出现的问题，注意点，影响范围等等。这么是为了让你能有把控力，比如你这个需求接入了新技术Es（Elasticsearch）你什么都不管你就是要接入它，你把他开发好了上线了，但是有啥坑你知道么？上线崩了怎么办？

不主动，不拒绝，不负责，这是渣男的行径，我们需要负起责任。

这个环节你需要考虑这个需求涉及到哪些服务了，需要新增哪些接口，修改哪些接口，表有现场的还是要新建表，字段要新建么？

其实远远不止这些问题，这就是我们做设计的主要原因，也是大家工作里面能成长的途径之一，你以为大佬们的经验是怎么来的？



目前根据公司内成员协调，我们省略掉了详设的步骤，只要简单的对接下实现方案和接口对接方式就可以啦，接口对接方式需要以详设的方式给出奥。这部分由后端研发成员牵头组织，辛苦大家啦。



**需求排期：概要设计完成后(1天内)，大家就要开始各自规划自己的排期了，排期一旦敲定就要严格按照排期表走啦，中途出现异常情况要及时和leader预警，说明原因，如果未按时交付，会被记录的kpi绩效的，需求反复预期，可能会被面临辞退的风险。**

我们已经在需求宣讲的环节，给出了比较详细的介绍啦。大家严格遵守接可以了，需求排期模板在这里。(UAT环境和上线环境的需求是一致的吆)。

 [排期表模板.xlsx](./排期表模板.xlsx) 

### 接口定义&开发&前后端联调：接口的定义在概要设计阶段已经做啦，这个环节其实比较好理解，啥都敲定了，那就开发呗，开发差不多了，就得前后端联调了。

这里有个小细节还是想说一下，一般开发前我们都会提前定义数据类型，接口名称，然后在公司的接口工具上给出链接和参数，方便前端爸爸mock数据(我们这里，概要设计就要定义好接口了)。他总不能等我们后端开发完了，才去开发嘛，这样效率打折扣，所以都是后端先定义好，然后前后端并行开发的。后端开发好，一般都是会发布到联调环境，我们有哪些环境，联调环境在我们所有的环境中处于哪个地位呢？

![测试流程](https://gitee.com/tizo_kingbb/picImg/raw/master/img/20211019134247.jpg)


按照后期规划我们的环境应该和上面类似，分别为本地dev环境2套(其中定义一套为联调环境)； 日常测试环境3套(用于单个需求测试不包含集成测试)； 预发UAT/灰度环境1套(阿里环境，需求系统集成测试);  线上环境一套(阿里环境) 



Tip：日常环境不能由开发人员发布，是因为测试流程比较久，所以不能中断，如果你一直发布会影响测试的效率，在发布期间他们是没办法干活的，而且很多部门涉及相同的服务，你发布还会影响别人。



测试发布之前，在测试群里问问可以发某个服务么，大家觉得不影响，那么就可以发了，懂了吧，需求是单个测试测自己负责的需求，所以要多环境分开测，不受其他测试人员影响，部署前先确认是否有其他测试人员在用该环境奥。



预发环境，也叫灰度环境，这是跟线上数据一样的一个环境，只是只能内网访问，一般这一步是防止很多是因为日常的数据量不够真实，数据级别达不到线上的量级无法测出的bug。



扯远了，联调完了就是代码Review了。



### 代码Review：代码Review在联调阶段其实就可以进行review了，不要等着一波allin，一下来七八个文件，5000到6000行新增，你的leader估计会吐血的，代码review是一个持续渐进的过程。



codeReview环节，画一下重点，这可能是整个研发流程中，让你成长最快的一个环节，让组员和Leader Review你的代码，往往他们能给你很多业务上和技术上的建议和意见。

过来人的经验你就说香不香吧，以前老大经常没时间，但是我就是烦着他要Review，后来他说不用review了，但是我还是要组员大佬review，因为我很享受别人对我提建议的时候，这不就是成长，扫盲的好时机嘛。

我们代码Review现在被定义为强制性的，大家的gitlab分支上相关的release分支的修改和提交都做了约束和限制，一般情况下大家是无法直接创建release发布分支的，什么release分支的含义是什么？

release分支统称为发布分支，我们定义了4中发布分支类型，以应对各种上线发布情况，同时和测试以及运维约定只会部署release发布分支，如果你的提测或上线分支不是release分支，那么不好意思，我们不会给你部署哈。话题扯远了，后面会有详细的章节给大家介绍这4中分支的来历和使用方式，以及代码是怎么review的，刚才才提到一般情况下大家是无法创建release发布分支的？ 那么什么时候我们普通研发人员才可以创建relase发布分支呢？这个问题我们后续讲解。



### 提测&产品第一次验收：(提测期间会有2个小小的会议，测试用例评审; showcase需求成果演示)

测试用例的评审日期，测试人员已经在排期表上明确的给出了，我们只要准时参与一起投入到测试的视角，来过一遍测试用例就可以了，来避免接下来的工作中，测试人员和研发人员对需求理解和功能测试点的偏差，当然这也是测试人员绩效考核的一部分。

showcase需求成果演示，也叫做冒烟测试，该阶段是由需求负责人拉会组织的，主要作用就是给UI小姐姐看看我们的界面完成度，给产品爸爸看看我们的完成情况，有没有需求点漏掉啊。给测试爷爷看看我们的实现是不是通畅的，没有严重的阻碍行bug，一切顺畅进行，我们就可以安全提测啦，如果中途出现流程阻断，需求点遗漏，UI界面与原图不符合，那么你就悲剧了，我们定义为提测失败啦。

showcase成功后，把代码都发到日常环境，然后等测试爸爸测试，这个环节开发同学如果没BUG是比较轻松的，等着就好了，如果目前需求比较多，你也可以投身于下一场战斗中。

但是如果你BUG多，那我觉得你可能会生不如死，因为有的bug真的找很久很久的，调用链路又长，特别是跨服务又涉及消息队列，或者第三方的接口什么的。总之你也不知道会出现什么bug，我看身边的大神也只能用经验避免常见的吭，孰能生巧吧。

### 灰度(UAT)发布,系统集成测试)

不要以为日常测试环境测试通过就OK了，这只是成功的一小步，接下来我们就进入UAT的系统测试啦，所谓的系统测试就是将将要上线的多个需求融合到一个分支上，部署到UAT环境上测试，UAT环境上的数据是很宝贵的，不能乱动的奥。

集成测试你提测的需求因为环境原因或者其他原因导致流程运行异常了，或者发现了其他的需求内的bug，这个时候bug需要在原分支修改bug并给相应leader代码Review之后，再重新打包部署。

UAT环境需求稳定无异常之后，我们就可以准备一个时间发布啦。



### 发布计划

敲黑板，这个确实是比较重要的环节，这个环节主要是开发同学和前端同学说好一个发布时间，然后制定一个发布计划，为啥要发布计划呢?

我们开发一个需求，可能涉及到N个服务，这些服务是有依赖关系的，那就需要打包，比如订单系统，依赖人员系统。优惠券系统，也依赖人员系统，然后订单系统还依赖优惠券系统，是不是有点乱了？这个时候一定要在发布工单内备注好发布顺序，避免部署原因导致的异常，导致部署失败。

我们的发布计划是一个固定的时间按段，排期表内项目主管会根据最后的测试日期给出相应的UAT集成测试时间和上线时间，一般来讲UAT和上线时间的间隔，在一天之内。

具体发布计划的时间段，我们做了如下的安排：

1. 主版本发布计划：定义为每2周一次，定义为主版本周的周三晚上发布，具体的发布时间需要和运营人员协商，主版本上相关需求的研发人员要后备在公司奥，防止出现紧急情况，而又找不到人员，导致上线失败。UAT预发在主版本之前的前一天，也就是说周二就要上UAT环境做集成测试。

2. 故障列车发布计划： 定义为每2周一次，什么是故障列车？设想一个场景，测试给你反馈的线上故障是实时性的，也就是说指不定什么时候你就收到了线上故障，这个时候你把他解决了就要立马上线嘛？对于紧急致命的故障是可以的，对于一般的小故障也需要这样操作码？显然是不可能的，所以我们产出了故障列车的概念，你可以理解为他就是一个故障解决的收集容器，这个容器2周内发布到线上一次，我们解决了哪些故障，链接到这个容器上，并通过工单(jira单后续讲解)告诉测试人员就可以啦。
   故障列车是由测试人员创建的，定义为故障周的周四早上9点创建，周四周五收尾，错过这个时间段，不好意思，你只能等待下次故障车了。除非你真的比较紧急，或者说真的故障挂在自己身上不舒服，那么你就告知下本次故障的车的负责人，人家同意了你就可以链接上去啦。
   故障列车的上线和主版本是一起的，他们采用错周的方式，最终在下两周的周二的主版本上合并集成到UAT环境，周三一起上线。不好理解? 我们画图吧！

   ![工单创建时间](https://gitee.com/tizo_kingbb/picImg/raw/master/img/20211019134303.png)

### 日志观察&产品第二次验收(UAT环境和线上环境间隔一天的暂缓日期, 我们暂定为运营和产品的验收在UAT集成上面啦，上线之后通知产品和运营在点点就可以啦)

一般发布第一批之后不会马上发布第二批，而是观察错误日志，看看是否正常，有时候会发现还是会出现异常情况的，那就保留错误日志，然后回滚。

知道解决了再发布，顺利的话就没啥错误，一口气发完了，看了下时间凌晨了，那发完差不多也得回家了。

一次发布可能涉及服务多的话，真的有可能发布这么久，但是没办法，线上出问题就是掉脑袋的事情。

日志观察一般公司都有错误日志搜集系统，或者自己登录跳板机查看就好了。

没问题，发完之后告诉产品大大就好了。这个时候产品就可以过一下自己想要的东西啦，产品可以带着运营过我们的应用啦。



### 需求结束

至此基本上一个需求可能就结束了，其实还是很不容易的，短的需求几天，长的需求几个月，中间涂涂改改，BUG，技术难点都是你要面对的，不过没啥大问题，我们技术人嘛皮实能顶。

上线之后可能还出现一些细微的bug，等待下次故障列车修复就可以啦。

另外上线部署成功后不要忘记在研发群里面通报给项目主管，另外上线部署环节的时候，测试人员要部署上线啦，要经过产品，职能线leader(包含测试线leader)同意后才可以让运维部署实施奥。

### 总结

产品研发流程大家是不是觉得有点复杂，或者觉得很多点有点小题大做了，不瞒你说，刚开始我也这么认为的，但是随着时间的推移，你会发现有时候越是这样规范，越是提升了效率，也提升了产品质量。

对自己设计的严苛也会让你的业务能力提升，开发考虑的点也越来越广泛，我想大佬应该都是这样走过去的，那没啥好说的，我们也走。



### TIP: 这里只是简单的介绍了，我们的研发流程，后面我们还有2篇文章，一篇为jira工单的填写规范，以及什么时机去创建他，由谁负责，另一篇为gitlab代码规范，统一研发标准，统一分支开发规范，relase分支的创建和种类。他们三个是相辅相成的，谁也离不开谁，当然研发流程是基础，大家要熟透它。